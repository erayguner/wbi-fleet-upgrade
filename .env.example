# WBI Fleet Upgrade & Rollback - Environment Configuration Example
#
# Copy this file to .env and customize for your environment:
#   cp .env.example .env
#
# Then use with bash wrappers:
#   source .env
#   ./wb-upgrade.sh --dry-run

# ============================================================================
# Required Configuration
# ============================================================================

# Your GCP Project ID
# Example: GCP_PROJECT_ID=my-project-123
GCP_PROJECT_ID=

# Space-separated list of GCP zones to scan for instances
# Example: LOCATIONS="europe-west2-a europe-west2-b us-central1-a"
LOCATIONS=

# ============================================================================
# Operation Mode
# ============================================================================

# Dry-run mode (recommended for safety)
# Set to 'false' for actual operations
# Default: true
DRY_RUN=true

# Single instance mode (optional)
# Leave empty for fleet mode, or specify an instance ID
# Example: INSTANCE_ID=my-notebook-instance
INSTANCE_ID=

# ============================================================================
# Safety Settings
# ============================================================================

# Automatic rollback on upgrade failure
# Set to 'true' for production instances
# Default: false
ROLLBACK_ON_FAILURE=false

# Maximum number of concurrent operations
# Lower = safer/slower, Higher = faster/risky
# Recommended: 5 for production, 10 for development
# Default: 10
MAX_PARALLEL=10

# Delay between starting operations (seconds)
# Prevents API rate limiting
# Increase if experiencing 429 errors
# Default: 3.0
STAGGER_DELAY=3.0

# ============================================================================
# Timeouts
# ============================================================================

# Maximum time to wait per operation (seconds)
# Default: 7200 (2 hours)
TIMEOUT=7200

# Time to wait for instance to become ACTIVE after operation (seconds)
# Default: 600 (10 minutes)
HEALTH_CHECK_TIMEOUT=600

# Time between operation status checks (seconds)
# Default: 20
POLL_INTERVAL=20

# ============================================================================
# Logging
# ============================================================================

# Enable verbose logging
# Set to 'true' for detailed output
# Default: false
VERBOSE=false

# Enable JSON structured logging (Cloud Build)
# Default: true
JSON_LOGGING=true

# ============================================================================
# Example Configurations
# ============================================================================

# Development Environment (Fast, less safe)
# MAX_PARALLEL=20
# STAGGER_DELAY=2.0
# TIMEOUT=3600
# DRY_RUN=true

# Production Environment (Safe, controlled)
# MAX_PARALLEL=5
# STAGGER_DELAY=5.0
# TIMEOUT=10800
# ROLLBACK_ON_FAILURE=true
# HEALTH_CHECK_TIMEOUT=900
# VERBOSE=true
# DRY_RUN=false  # Only after testing!

# Single Critical Instance
# MAX_PARALLEL=1
# ROLLBACK_ON_FAILURE=true
# HEALTH_CHECK_TIMEOUT=1200
# VERBOSE=true
# DRY_RUN=false  # Only after testing!

# ============================================================================
# Cloud Build Substitutions
# ============================================================================

# Use these as Cloud Build substitutions:
# gcloud builds submit --config=cloudbuild.yaml \
#   --substitutions=_PROJECT_ID=$GCP_PROJECT_ID,\
#_LOCATIONS="$LOCATIONS",\
#_DRY_RUN=$DRY_RUN,\
#_MAX_PARALLEL=$MAX_PARALLEL

# ============================================================================
# Notes
# ============================================================================

# 1. Always test with DRY_RUN=true first
# 2. Start with a single instance before fleet operations
# 3. Use ROLLBACK_ON_FAILURE=true for production
# 4. Monitor logs actively during operations
# 5. Verify instance health after operations complete
# 6. Keep this file secure (don't commit with real values)

# For more information:
# - Quickstart: QUICKSTART.md
# - Operations: OPERATIONS.md
# - Cloud Build: docs/cloud-build.md
